%************************************************
\chapter{Installare CodeIgniter}
\label{cap:installazione}
%************************************************

Questo capitolo spiega in maniera concisa e si spera chiara, come installare CodeIgniter a prescindere dal sistema operativo utilizzato. La guida è stata realizzata basandosi sulla versione 2.2.0 disponibile sul sito ufficiale: \url{http://ellislab.com/codeigniter}. Il framework per poter funzionare correttamente deve essere utilizzato su una macchina con installato \ac{PHP} e un server web come Apache.

\section{Server locale e remoto}
Esistono due soluzioni per creare un ambiente idoneo allo sviluppo: realizzare un server web locale o uno remoto. Le due soluzioni mettono a disposizione ambedue un sistema caratterizzato dagli stessi software di base come Apache, \ac{MySQL} e \ac{PHP}, ma differiscono per la dislocazione delle macchine. Un server locale è una macchina che fisicamente è situata nelle vicinanze dello sviluppatore e che soventemente si identifica con il sistema utilizzato quotidianamente. Diverse soluzioni software permettono infatti di realizzare un sistema casalingo per lo sviluppo e la fruizione dei contenuti web. Un server remoto, come si evince dalla parola stessa, è una macchina non disponibile fisicamente. Solitamente essa viene messa a disposizione da apposite aziende commerciali sotto forma di hosting o housing con pacchetti che variano dalle poche decine di euro alle migliaia di euro l'anno. L'oscillazione dipende dalle funzionalità del server, dalla sua potenza e dall'assistenza fornita dall'azienda. L'utilizzo di un server remoto non è però strettamente necessario per realizzare un ambiente votato allo sviluppo, pertanto si esamineranno le soluzioni più immediate per installare e utilizzare un server locale.

\section*{Requisiti minimi e installazione}
Le richieste di CodeIgniter sono tutto sommato modeste per quanto riguarda l'hardware, mentre lato software, la compatibilità con \ac{PHP} si ha dalla versione 5.1.6 o più recente. Un database è richiesto per lo sviluppo della maggior parte delle applicazioni web, mentre le basi di dati attualmente supportate sono: MySQL (4.1+), MySQLi, MS SQL, Postgres, Oracle, SQLite, e ODBC.

\label{sec:installazione}
\subsection{Installazione per Windows}
Sotto il sistema Microsoft esistono numerose soluzioni denominate \ac{WAMP}: vere e proprie piattaforme software di sviluppo web/database basate su Apache, MySQL e PHP, Perl, Python o altri linguaggi di scripting. Una soluzione pronta all'uso è \copyl{Wamp Stack} della Bitnami che nel sito ufficiale \url{https://bitnami.com/stack/wamp} mette a disposizione un pacchetto autoinstallante e assolutamente amichevole. Oltre a comprendere tutto l'occorrente per avere una macchina locale dedicata allo sviluppo con i principali framework, comprende altri componenti come phpMyAdmin (per la gestione del database), OperSSL, PEAR, PECL e altri importanti software sul cui scopo, per ora, si potrà sorvolare. 

\begin{img}{Bitnami: it's work!}{5}{007}
\end{img}

Un'altra soluzione molto utilizzata è \copyl{EasyPHP} \url{http://www.easyphp.org/} per creare in pochi passi un ambiente di sviluppo ottimizzato per la programmazione e il debug delle applicazioni. Un aspetto che potrebbe essere rilevante per alcuni utenti, è che EasyPHP è portatile: basta una chiavetta USB o un hard disk portatile per trasformare ogni macchina, all'occorrenza, in un server web pronto all'uso. Chi fosse particolarmente curioso può trovare altre soluzioni, semplicemente effettuando una ricerca in Rete con il termine \ac{WAMP}.

\begin{img}{EasyPHP}{3}{008}
\end{img}

\begin{img}{EasyPHP: code tester}{3}{009}
\end{img}

\subsection{Installazione per Mac OS}
Molte sono anche le soluzioni ``pronte all'uso'' per Mac OS X (ma anche versioni precedenti del sistema operativo Apple), definite semplicemente \ac{MAMP}. Tra i tanti software citiamo la proposta dell'azienda \copyl{appsolute} che fornisce un pacchetto liberamente utilizzabile ed una versione PRO a pagamento dotata di maggiori funzionalità. Per le nostre esigenze, la versione gratuita sarà più che sufficiente: \url{http://www.mamp.info/en/}

\begin{img}{MAMP - schermata iniziale}{5}{010}
\end{img}

\begin{img}{MAMP - PHP}{5}{011}
\end{img}

\subsection{installazione per GNU/Linux}
Questo è il sistema di riferimento per la produzione. Nonostante non tutti abbiano le conoscenze e la pazienza per padroneggiare un sistema operativo differente da quello solitamente utilizzato, vale la pena prima o poi muovere i passi nell'affascinante mondo del software libero. La procedura di installazione varia a seconda della distribuzione utilizzata: qui prenderemo in esame quella per il sistema Ubuntu, una della maggiori distruzioni per diffusione tra utenti consumer. Esistono diverse modalità per l'installazione di \ac{LAMP} e per tutte è obbligatorio avere i permessi di amministratore \ac{su}. Esamineremo alcune procedure:

\begin{description}
\item[mediante tasksel] Probabilmente la soluzione più veloce. Aprendo il terminale bash, si esegua il comando per installare ``tasksel'':

\begin{code}
sudo apt-get install tasksel
\end{code}

Successivamente si esegua l'istruzione:

\begin{code}
sudo tasksel
\end{code}

Dal menu proposto, si selezionerà l'installazione ``Lamp server''. Successivamente si potranno installare altri utili moduli come ``PhpMyAdmin'' con:

\begin{code}
sudo apt-get install phpmyadmin
\end{code}

\item[mediante Synaptic] \'E un ottimo software center per gestire le applicazioni di sistema: lo si trova su Sistema > Amministrazione > Synaptic Package Manager; se non presente nella distruzione GNU/Linux, lo si può installare con il comando da terminale:

\begin{code}
sudo apt-get install synaptic
\end{code}

Successivamente si apra il programma dotato di interfaccia grafica e si selezioni dal menu ``Modifica'' la voce ``Marca i pacchetti per attività''. Si aprirà una finestra in cui si dovrà selezionare l'opzione ``LAMP server''; infine, si confermi l'operazione premendo su ``OK'' (si veda la figura \vpageref{fig:012}).
\end{description}

\begin{img}{Synaptic - installazione LAMP}{5}{012}
\end{img}

\begin{img}{MySQL ha bisogno di una password}{5}{013}
\end{img}

\subsection{Configurare e verificare il server}
In fase di installazione si dovranno apportare alcune modifiche e verificare alla fine il corretto funzionamento del server. Esaminiamole nel dettaglio:

\begin{enumerate}
\item durante l'installazione verrà chiesta la password per MySQL (si veda l'immagine\vpageref{fig:013}). Si inserisca una password (non dimenticatela!), e si tenga presente che il nome utente/login è ``root'', infine si concluda l'installazione.
\item a fine installazione si verifichi la corretta presenza sul proprio sistema di Apache scrivendo sul terminale bash:

\begin{code}
sudo /etc/init.d/apache2 restart
\end{code}

Se aprendo un browser qualsiasi e digitando nella barra degli indirizzi:

\begin{code}
http://localhost
\end{code}

compare una schermata di benvenuto o un messaggio ``it Works!'', significa che l'installazione di Apache è andata a buon fine (altrimenti si veda\vpageref{sec:problemi}).

\item Per testare l'installazione del \ac{PHP} si crei un file di nome \fil{info.php} con il seguente codice:

\begin{code}
<?
	phpinfo();
?>
\end{code}

Si salvi il file e lo si copi nella directory del server web locale (che su sistemi GNU/Linux si trova generalmente nel percorso \sys{/var/www/}).

Nella barra degli indirizzi del browser si digiti:

\begin{code}
http://localhost/info.php
\end{code}

Se anche \ac{PHP} è presente nel vostro sistema, apparirà una schermata con il riepilogo dei parametri principali (si veda l'immagine\vpageref{fig:014}).

\begin{img}{PHP: info}{5}{014}
\end{img}

\end{enumerate}

\section{Installare CodeIgniter}
Una volta scaricato il framework sotto forma di file compresso lo si decomprima nella directory del proprio server web. Fatto questo, nella cartella sarà presente il file \fil{index.php} che, insieme alle directory \sys{System} e \sys{Application}, costituiranno l'ossatura di CodeIgniter. Per verificare il corretto funzionamento del framework (se lo avete installato in una cartella dal nome \sys{codeigniter}), digitate:

\begin{code}
http://localhost/index.php/codeigniter/
\end{code}

Bene, ora si è ``quasi'' pronti ad assaporare le potenzialità di questo potente tool di sviluppo. 

\begin{table}
\caption{Database supportati da CodeIgniter}
\label{tab:dbsupportati}
\centering
\begin{tabular}{lcr}
\toprule
Database & Versione \\ 
\midrule
MySQL & 4.1 \\
\midrule
MySQLi \\
\midrule
MS SQL \\
\midrule
Postgres \\
\midrule
Oracle \\
\midrule
SQLite \\
\midrule
ODBC\\
\bottomrule
\end{tabular}
\end{table}

\label{cap:dbconfig}
\section{Configurazione}
Gli utenti esperti potranno configurare alcuni aspetti di CodeIgniter aprendo con un editor di testo i seguenti due file:

\begin{itemize}
\item \sys{/application/config/config.php}. Qui si dovrà settare il nostro \ac{URL} di base ed eventualmente impostare altri parametri come la chiave di criptazione (encryption key), il formato della data, il linguaggio o i parametri \ac{URI}.
\item \sys{/application/config/database.php}. In questo file si inseriranno i dati di accesso al database, se si intende utilizzarne uno, ovviamente.
\end{itemize}

Una opzione degna di nota nel \fil{config.php} è quella che imposta l'\ac{URL} di base del proprio server remoto. Se l'indirizzo di primo livello è per esempio \emph{http://esempio.com} e CodeIgniter è installato in una sottodirectory chiamata ``mioProgetto'', è possibile definire la radice dell'intero progetto con il seguente parametro:

\begin{code}
$config['base_url'] = "http://esempio.com/mioProgetto";
\end{code}

Se invece si lavora in un ambiente locale il parametro dovrà tenere conto dell'URL di base (localhost oppure 127.0.0.1):

\begin{code}
$config['base_url'] = "http://localhost/mioProgetto";
\end{code}

oppure

\begin{code}
$config['base_url'] = "http://127.0.0.1/mioProgetto";
\end{code}

Nota: i termini localhost e 127.0.0.1 sono equivalenti e richiamano ambedue il server locale utilizzato in fase di sviluppo.

Comunque chi non avesse esperienza nella configurazione di un server web, può tranquillamente evitare per il momento di mettere mano ai preziosi file di configurazione.

\label{sec:accessodb}
Se la nostra applicazione dovrà collegarsi ad una base di dati sarà necessario configurare anche il file \fil{database.php} localizzato al percorso \sys{/application/config/database.php}

Qui sarà possibile impostare le seguenti voci:

\begin{code}
['hostname']: il nome di host del database server;
['username']: lo username per la connessione al database;
['password']: la password per la connessione al database;
['database']: il nome del database che si desidera selezionare;
['dbdriver']: il tipo di database che si desidera utilizzare;
['dbprefix']: il prefisso da associare opzionalmente al nome delle tabelle;
['pconnect']: valori TRUE o FALSE per connessioni persistenti o meno;
['db_debug']: valori TRUE o FALSE per visualizzare gli errori del database;
['cache_on']: valori TRUE o FALSE per abilitare o meno la cache delle query;
['cachedir']: consente di definire il percorso alla cache delle query;
['char_set']: definisce il set di caratteri per le comunicazioni al database;
['dbcollat']: definisce la collation di caratteri per le comunicazioni al DB.
\end{code}

\begin{deftabg}{Gli insiemi di caratteri}
\textbf{character set} & Sono i diversi sistemi con cui i caratteri alfanumerici, i segni di punteggiatura e qualsiasi simboli visualizzabile su un computer vengono memorizzati in un valore binario. \\
\midrule
\textbf{collation} & Ad ogni character set è associata una o più collaction, che rappresentano i modi possibili di confrontare le stringhe di caratterei di uno stesso insieme di caratteri. \\
\end{deftabg}

Se per esempio si dispone di un database di nome \var{test} a cui è possibile accedere con i dati di login \var{mioNome} e password \var{1234}, i dati nel file \fil{database.php} dovranno essere così impostati:

\begin{code}
$db['default']['hostname'] = 'localhost';
$db['default']['username'] = 'mioNome';
$db['default']['password'] = '1234';
$db['default']['database'] = 'test';
$db['default']['dbdriver'] = 'mysql';
\end{code}

L'ultima riga indica che stiamo utilizzando un database di tipo MySQL. 

\section{Primi accorgimenti per la sicurezza}
Se si desidera incrementare la sicurezza nascondendo il percorso dei propri file di CodeIgniter, è possibile rinominare le directory \sys{System} e \sys{Application} per renderle meno evidenti; successivamente si apra il file \fil{index.php} e si configurino opportunamente le variabili \verb|$system_path| e \verb|$application_folder| inserendo i nomi delle direcotry precedentemente modificati.

Se si è particolarmente diffidenti (e questo è un bene) è consigliabile rendere inaccessibili sia la directory \sys{System} che quella \sys{Application} ad un browser web. Normalmente i file \fil{.htaccess} sono inclusi in ogni directory per prevenire l'accesso diretto, ma è consigliato rimuoverli dall'accesso pubblico quando non siano strettamente necessari o la configurazione del server web cambia. 

Una ulteriore misura da adottare in fase di produzione è quella di disabilitare gli avvisi che mostrano gli errori di \ac{PHP}, e qualsiasi altro messaggio che riporti informazioni non rilevanti per l'utente. In CodeIgniter questo può essere fatto settando opportunamente le costanti \var{ENVIROMENT} sempre all'interno di \fil{index.php}. I valori selezionabili sono: development, testing e production.

Per il momento, non ci si preoccupi troppo poiché le misure da adottare per la sicurezza del proprio progetto saranno affrontate successivamente nel capitolo\vref{cap:sicurezza}.

\section{Siamo pronti}
A questo punto s è pronti per visualizzare la nostra prima schermata di benvenuto. Se tutto è filato liscio, inserendo nel browser il seguente indirizzo:

\begin{code}
http://127.0.0.1/index.php/codeigniter/
\end{code}

dove \sys{codegniter} è il nome dato alla directory in cui si trova il framework installato nel server web, comparirà la schermata di benvenuto mostrata\vpageref{fig:015}.

\begin{img}{Il benvenuto di CodeIgniter}{5}{015}
\end{img}

\label{sec:welcome}
CodeIgniter ci saluta, invitandoci a modificare la pagina introduttiva \fil{welcome.php} che si trova al percorso \verb|application/views/welcome_message.php| e il corrispettivo Controller situato su \verb|application/controllers/welcome.php|. A completare il messaggio vi è un rimando alla pratica guida, che si può consultare anche in locale nella directory \verb|user_guide/|. 

Per il momento, evitiamo di seguire l'invito di CodeIgniter e di apportare qualsiasi modifica: dobbiamo ancora impratichirci con i concetti base.

\label{sec:problemi}
\section{Risoluzione dei problemi}
\'E assai improbabile che la fase di installazione non porti a qualche inconveniente, soprattutto se non si ha molta dimistichezza con la configurazione di un server. Qui di seguito sono passati in rassegna alcuni dei problemi più comuni nell'installazione e configurazione di CodeIgniter.

\begin{description}
\item[Pagine non caricate] se si scopre che nonostante ciò che inseriamo nel nostro \ac{URL} del browser, solo la pagina di default viene caricata, questo potrebbe significare che il server non supporta la variabile \verb|PATH_INFO| necessaria per mostrare \ac{URL} amichevoli ai motori di ricerca. Come primo passo si apra il file \fil{config.php} al percorso \sys{/application/config/} quindi si cerchino le informazioni sul protocollo \ac{URI}. \'E consigliabile provare un paio di impostazioni alternative. Se ancora non funziona dopo aver provato questo metodo, si dovrà forzare CodeIgniter per aggiungere un punto interrogativo agli \ac{URL}. Per fare questo, si apra il \fil{config.php} al percorso \sys{/application/config/}, e si modifichi:

\begin{code}
$config['index_page'] = "index.php";
\end{code}

con:

\begin{code}
$config['index_page'] = "index.php?";
\end{code}

\item[Permessi] non si riesce a copiare CodeIgniter nella root del proprio server web? Potrebbe essere un problema legato ai permessi. Solitamente solo l'amministratore può scrivere/modificare i file in questa cartella, quindi una soluzione veloce è quella di copiare i file con i permessi di super user, facendo precedere ogni vostro comando dalla stringa \ac{su}. Per esempio, una volta scaricato e decompresso il file zip che contiene CodeIgniter, questo può essere copiato nella directory del server con:

\begin{code}
su cp codeigniter /var/www/MioProgetto/
\end{code}

Con il comando \ac{su} si acquisiranno per breve tempo i ``poteri'' di amministratore, ma ovviamente si dovrà conoscere l'apposita password. Un'altra soluzione, meno consigliata sotto il profilo della sicurezza, è quella di modificare i permessi di scrittura/lettura della directory del server web. In questo caso, il comando ``su chmod -R 777'', eseguito nel percorso \sys{/var/www/} permetterà a chiunque di scrivere e modificare i file del vostro progetto: comodo ma rischioso se il computer è accessibile ad altri utenti.
\item[Attenzione ai dettagli] verificate il percorso inserito nel browser. A volte basta un carattere in più (o in meno), una maiuscola nell'indirizzo per visualizzare un errore ``404 not found'' e farci sprofondare nella disperazione più totale.
\item[Servizi web] se digitando \verb|http://127.0.0.1| la pagina che vi si presenta è un desolante ``404 not found'' è probabile che non siano stati avviati i servizi web per far funzionare correttamente il vostro server locale. Provate a digitare:

\begin{code}
sudo service mysqld start
\end{code}

e successivamente:

\begin{code}
sudo service httpd start
\end{code}

Collegatevi nuovamente all'indirizzo \verb|http://127.0.0.1| e incrociate le dita.
\item[Trovare la soluzione da soli] leggete con attenzione i messaggi di errore. Se legati a CodeIgniter sono spesso accompagnati da informazioni che ne permettono l'individuazione e la risoluzione: basterà una ricerca in rete, magari nel forum della community per venirne a capo facilmente.
\end{description}